import { isNull, isUndefined } from 'lodash-es';
/**
 * Injects webpack entrypoints with HMR client scripts.
 *
 * Filters on `webpack.entry`
 *
 * @public
 */
export const inject = (app, injection) => {
    app.hooks.on('build.entry', entrypoints => {
        if (!injection)
            return;
        if (app.isRoot) {
            const missing = !entrypoints || isUndefined(entrypoints) || isNull(entrypoints);
            entrypoints = missing
                ? {
                    app: {
                        import: ['index'],
                    },
                }
                : entrypoints;
        }
        return Object.entries(entrypoints).reduce((entrypoints, [name, entry]) => {
            if (!entry)
                return entrypoints;
            entry.import = Array.from(new Set([
                ...injection.map(inject => inject(app)),
                ...(entry.import ?? []),
            ].filter(Boolean)));
            return { ...entrypoints, [name]: entry };
        }, {});
    });
};
//# sourceMappingURL=inject.js.map